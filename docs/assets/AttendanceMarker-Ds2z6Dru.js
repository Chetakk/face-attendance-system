import{r as l,j as e,C as b,a as h,L as y,b as j,l as C,d as N,g as w,s as g,c as k}from"./index-B5QmgcMj.js";function P(){const[x,o]=l.useState(!1),[d,c]=l.useState(!1),[n,s]=l.useState(null),m=async p=>{c(!0),s(null);try{await C();const a=await N(p);if(!a){s({type:"error",text:"No face detected. Please ensure your face is clearly visible."}),c(!1);return}const v=w(a),{data:i,error:u}=await g.from("users").select("*").not("face_descriptor","is",null);if(u)throw u;if(!i||i.length===0){s({type:"error",text:"No registered users found. Please register first."}),c(!1);return}let r=null;for(const t of i)if(t.face_descriptor){const f=k(a.descriptor,t.face_descriptor);(!r||f>r.confidence)&&(r={user:t,confidence:f})}if(r&&r.confidence>.6){const{error:t}=await g.from("attendance_records").insert({user_id:r.user.id,face_match_confidence:(r.confidence*100).toFixed(2)});if(t)throw t;s({type:"success",text:`Welcome ${r.user.name}! Attendance marked successfully.`}),o(!1)}else s({type:"error",text:"Face not recognized. Please try again or register first."})}catch(a){console.error("Error processing face:",a),s({type:"error",text:"An error occurred. Please try again."})}finally{c(!1)}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Mark Attendance"}),n&&e.jsxs("div",{className:`mb-6 px-4 py-3 rounded-lg flex items-center gap-3 ${n.type==="success"?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800"}`,children:[n.type==="success"?e.jsx(b,{size:24,className:"flex-shrink-0"}):e.jsx(h,{size:24,className:"flex-shrink-0"}),e.jsx("p",{children:n.text})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 mb-6",children:"Click the button below to activate the camera and mark your attendance using facial recognition."}),e.jsx("button",{onClick:()=>o(!0),disabled:d,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-8 py-3 rounded-lg font-medium inline-flex items-center gap-2 transition-colors",children:d?e.jsxs(e.Fragment,{children:[e.jsx(y,{size:20,className:"animate-spin"}),"Processing..."]}):"Start Camera"})]}),e.jsx(j,{isActive:x,onCapture:m,onClose:()=>o(!1)})]})}export{P as default};
